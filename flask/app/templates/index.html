<!DOCTYPE html>
<html>
    <head>
        <link href="../static/css/style.css" rel="stylesheet">
        <link rel="icon" type="image/png" href="../static/img/favicon.png">

        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@100..900&display=swap" rel="stylesheet">

        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.js"></script>
        <title>捷運大富翁-主頁</title>
    </head>
    <body>
        <div class="top">
            <nav class="nav">
                <a href="/" class="nav-item" active-color="gray">主頁</a>
                <a href="/combo" class="nav-item" active-color="gray">組合</a>
                <a href="/team_admin" class="nav-item" active-color="gray">隊隨</a>
                <span class="nav-indicator"></span>
            </nav>
            
            <div class="user_info">
                <p>{{ team }} - {{current_user}}</p>
            </div>
        </div>

        <div class="MRT_map">
            <img id="Map0" src="../static/img/map/MRT_map0.png" usemap="#image-map" style="display: none;">
            <img id="Map1" src="../static/img/map/MRT_map1.png"  usemap="#image-map" style="display: none;">
            <img id="Map2" src="../static/img/map/MRT_map2.png" usemap="#image-map" style="display: none;">
            <img id="Map3" src="../static/img/map/MRT_map3.png" usemap="#image-map" style="display: none;">
            <img id="Map4" src="../static/img/map/MRT_map4.png" usemap="#image-map" style="display: none;">
        </div>
        
        <!-- Image Map Generated by http://www.image-map.net/ -->
        <map name="image-map">
            <!-- 紅 -->
            <!-- 
            <area onclick=station_info(this.title) title="淡水"  coords="10,110,99,177" shape="rect" data-original-coords="10,110,99,177">
            <area onclick=station_info(this.title) title="紅樹林"  coords="8,194,107,273" shape="rect" data-original-coords="8,194,107,273">
            <area onclick=station_info(this.title) title="竹圍"  coords="17,283,101,340" shape="rect" data-original-coords="17,283,101,340">
            <area onclick=station_info(this.title) title="關渡"  coords="12,347,105,406" shape="rect" data-original-coords="12,347,105,406">
            <area onclick=station_info(this.title) title="忠義"  coords="111,410,175,479" shape="rect" data-original-coords="111,410,175,479">
            <area onclick=station_info(this.title) title="復興崗"  coords="182,413,240,481" shape="rect" data-original-coords="182,413,240,481">
            <area onclick=station_info(this.title) title="北投"  coords="246,415,298,474" shape="rect" data-original-coords="246,415,298,474">
            <area onclick=station_info(this.title) title="奇岩"  coords="303,413,352,480" shape="rect" data-original-coords="303,413,352,480">
            <area onclick=station_info(this.title) title="唭哩岸"  coords="357,416,411,480" shape="rect" data-original-coords="357,416,411,480">
            <area onclick=station_info(this.title) title="石牌"  coords="421,411,468,478" shape="rect" data-original-coords="421,411,468,478">
             -->
            <area onclick=station_info(this.title) title="明德"  coords="484,463,570,509" shape="rect" data-original-coords="484,463,570,509">
            <area onclick=station_info(this.title) title="芝山"  coords="477,526,571,576" shape="rect" data-original-coords="477,526,571,576">
            <area onclick=station_info(this.title) title="士林"  coords="478,586,569,629" shape="rect" data-original-coords="478,586,569,629">
            <area onclick=station_info(this.title) title="劍潭"  coords="478,639,569,696" shape="rect" data-original-coords="478,639,569,696">
            <area onclick=station_info(this.title) title="圓山"  coords="466,703,582,754" shape="rect" data-original-coords="466,703,582,754">
            <area onclick=station_info(this.title) title="民權西路"  coords="467,759,572,859" shape="rect" data-original-coords="467,759,572,859">
            <area onclick=station_info(this.title) title="雙連"  coords="467,865,579,909" shape="rect" data-original-coords="467,865,579,909">
            <area onclick=station_info(this.title) title="中山"  coords="478,914,569,980" shape="rect" data-original-coords="478,914,569,980">
            <area onclick=station_info(this.title) title="台北車站"  coords="586,1084,472,1018" shape="rect" data-original-coords="586,1084,472,1018">
            <area onclick=station_info(this.title) title="台大醫院"  coords="476,1092,604,1142" shape="rect" data-original-coords="476,1092,604,1142">
            <area onclick=station_info(this.title) title="中正紀念堂"  coords="477,1147,611,1206" shape="rect" data-original-coords="477,1147,611,1206">
            <area onclick=station_info(this.title) title="東門"  coords="643,1134,743,1208" shape="rect" data-original-coords="643,1134,743,1208">
            <area onclick=station_info(this.title) title="大安森林公園"  coords="754,1114,830,1206" shape="rect" data-original-coords="754,1114,830,1206">
            <area onclick=station_info(this.title) title="大安"  coords="914,1210,843,1125" shape="rect" data-original-coords="914,1210,843,1125">
            <area onclick=station_info(this.title) title="信義安和"  coords="942,1117,997,1203" shape="rect" data-original-coords="942,1117,997,1203">
            <area onclick=station_info(this.title) title="台北101/世貿"  coords="1002,1111,1060,1206" shape="rect" data-original-coords="1002,1111,1060,1206">
            <area onclick=station_info(this.title) title="象山"  coords="1067,1120,1115,1212" shape="rect" data-original-coords="1067,1120,1115,1212">
            <!-- 藍 -->
            <area onclick=station_info(this.title) title="南港展覽館"  coords="1182,812,1323,857" shape="rect" data-original-coords="1182,812,1323,857">
            <area onclick=station_info(this.title) title="南港"  coords="1191,879,1284,915" shape="rect" data-original-coords="1191,879,1284,915">
            <area onclick=station_info(this.title) title="昆陽"  coords="1179,931,1286,972" shape="rect" data-original-coords="1179,931,1286,972">
            <area onclick=station_info(this.title) title="後山埤"  coords="1189,988,1281,1031" shape="rect" data-original-coords="1189,988,1281,1031">
            <area onclick=station_info(this.title) title="永春"  coords="1120,1014,1180,1082" shape="rect" data-original-coords="1120,1014,1180,1082">
            <area onclick=station_info(this.title) title="市政府"  coords="1059,1014,1115,1081" shape="rect" data-original-coords="1059,1014,1115,1081">
            <area onclick=station_info(this.title) title="國父紀念館"  coords="1001,1002,1056,1088" shape="rect" data-original-coords="1001,1002,1056,1088">
            <area onclick=station_info(this.title) title="忠孝敦化"  coords="942,1003,997,1078" shape="rect" data-original-coords="942,1003,997,1078">
            <area onclick=station_info(this.title) title="忠孝復興"  coords="842,1000,924,1092" shape="rect" data-original-coords="842,1000,924,1092">
            <area onclick=station_info(this.title) title="忠孝新生"  coords="660,1016,785,1088" shape="rect" data-original-coords="660,1016,785,1088">
            <area onclick=station_info(this.title) title="善導寺"  coords="590,1013,652,1083" shape="rect" data-original-coords="590,1013,652,1083">
            <area onclick=station_info(this.title) title="西門"  coords="352,1031,450,1096" shape="rect" data-original-coords="352,1031,450,1096">
            <area onclick=station_info(this.title) title="龍山寺"  coords="239,1099,371,1158" shape="rect" data-original-coords="239,1099,371,1158">
            <area onclick=station_info(this.title) title="江子翠"  coords="246,1165,362,1207" shape="rect" data-original-coords="246,1165,362,1207">
            <area onclick=station_info(this.title) title="新埔"  coords="250,1224,333,1267" shape="rect" data-original-coords="250,1224,333,1267">
            <area onclick=station_info(this.title) title="板橋"  coords="243,1354,307,1410" shape="rect" data-original-coords="243,1354,307,1410">
            <area onclick=station_info(this.title) title="府中"  coords="250,1420,328,1461" shape="rect" data-original-coords="250,1420,328,1461">
            <area onclick=station_info(this.title) title="亞東醫院"  coords="240,1468,381,1503" shape="rect" data-original-coords="240,1468,381,1503">
            <!-- 
            <area onclick=station_info(this.title) title="海山"  coords="241,1516,351,1560" shape="rect" data-original-coords="241,1516,351,1560">
            <area onclick=station_info(this.title) title="土城"  coords="241,1577,335,1626" shape="rect" data-original-coords="241,1577,335,1626">
            <area onclick=station_info(this.title) title="永寧"  coords="246,1633,341,1689" shape="rect" data-original-coords="246,1633,341,1689">
            <area onclick=station_info(this.title) title="頂埔"  coords="249,1696,340,1737" shape="rect" data-original-coords="249,1696,340,1737">
            -->
            <!-- 綠 -->
            <area onclick=station_info(this.title) title="松山"  coords="1057,897,1118,974" shape="rect" data-original-coords="1057,897,1118,974">
            <area onclick=station_info(this.title) title="南京三民"  coords="1009,884,1052,965" shape="rect" data-original-coords="1009,884,1052,965">
            <area onclick=station_info(this.title) title="台北小巨蛋"  coords="940,881,996,974" shape="rect" data-original-coords="940,881,996,974">
            <area onclick=station_info(this.title) title="南京復興"  coords="833,881,912,973" shape="rect" data-original-coords="833,881,912,973">
            <area onclick=station_info(this.title) title="松江南京"  coords="660,900,774,971" shape="rect" data-original-coords="660,900,774,971">
            <area onclick=station_info(this.title) title="北門"  coords="403,903,465,971" shape="rect" data-original-coords="403,903,465,971">
            <area onclick=station_info(this.title) title="小南門"  coords="406,1130,474,1206" shape="rect" data-original-coords="406,1130,474,1206">
            <area onclick=station_info(this.title) title="古亭"  coords="651,1316,734,1397" shape="rect" data-original-coords="651,1316,734,1397">
            <area onclick=station_info(this.title) title="台電大樓"  coords="821,1345,878,1428" shape="rect" data-original-coords="821,1345,878,1428">
            <area onclick=station_info(this.title) title="公館"  coords="891,1360,942,1444" shape="rect" data-original-coords="891,1360,942,1444">
            <area onclick=station_info(this.title) title="萬隆"  coords="1046,1501,942,1459" shape="rect" data-original-coords="1046,1501,942,1459">
            <area onclick=station_info(this.title) title="景美"  coords="958,1518,1036,1567" shape="rect" data-original-coords="958,1518,1036,1567">
            <area onclick=station_info(this.title) title="大坪林"  coords="953,1578,1052,1629" shape="rect" data-original-coords="953,1578,1052,1629">
            <area onclick=station_info(this.title) title="七張"  coords="948,1637,1054,1686" shape="rect" data-original-coords="948,1637,1054,1686">
            <area onclick=station_info(this.title) title="新店區公所"  coords="943,1696,1105,1744" shape="rect" data-original-coords="943,1696,1105,1744">
            <area onclick=station_info(this.title) title="新店"  coords="943,1753,1048,1795" shape="rect" data-original-coords="943,1753,1048,1795">
            <!-- 橘 -->
            <area onclick=station_info(this.title) title="蘆洲"  coords="10,524,114,575" shape="rect" data-original-coords="10,524,114,575">
            <area onclick=station_info(this.title) title="三民高中"  coords="7,586,178,624" shape="rect" data-original-coords="7,586,178,624">
            <area onclick=station_info(this.title) title="徐匯中學"  coords="21,646,175,686" shape="rect" data-original-coords="21,646,175,686">
            <area onclick=station_info(this.title) title="三和國中"  coords="15,705,177,740" shape="rect" data-original-coords="15,705,177,740">
            <area onclick=station_info(this.title) title="三重國小"  coords="11,761,184,799" shape="rect" data-original-coords="11,761,184,799">
            <area onclick=station_info(this.title) title="大橋頭"  coords="216,770,323,860" shape="rect" data-original-coords="216,770,323,860">
            <area onclick=station_info(this.title) title="台北橋"  coords="131,866,243,913" shape="rect" data-original-coords="131,866,243,913">
            <area onclick=station_info(this.title) title="菜寮"  coords="127,921,222,961" shape="rect" data-original-coords="127,921,222,961">
            <area onclick=station_info(this.title) title="三重"  coords="128,973,213,1036" shape="rect" data-original-coords="128,973,213,1036">
            <area onclick=station_info(this.title) title="先嗇宮"  coords="136,1046,242,1091" shape="rect" data-original-coords="136,1046,242,1091">
            <area onclick=station_info(this.title) title="頭前庄"  coords="127,1150,224,1190" shape="rect" data-original-coords="127,1150,224,1190">
            <area onclick=station_info(this.title) title="中山國小"  coords="588,757,647,852" shape="rect" data-original-coords="588,757,647,852">
            <area onclick=station_info(this.title) title="行天宮"  coords="653,856,782,901" shape="rect" data-original-coords="653,856,782,901">
            <area onclick=station_info(this.title) title="頂溪"  coords="650,1432,751,1476" shape="rect" data-original-coords="650,1432,751,1476">
            <area onclick=station_info(this.title) title="永安市場"  coords="654,1489,775,1530" shape="rect" data-original-coords="654,1489,775,1530">
            <area onclick=station_info(this.title) title="景安"  coords="666,1540,740,1631" shape="rect" data-original-coords="666,1540,740,1631">
            <area onclick=station_info(this.title) title="南勢角"  coords="656,1642,755,1680" shape="rect" data-original-coords="656,1642,755,1680"> 
            <!-- 
            <area onclick=station_info(this.title) title="新莊"  coords="133,1283,213,1328" shape="rect" data-original-coords="133,1283,213,1328">
            <area onclick=station_info(this.title) title="輔大"  coords="133,1346,216,1384" shape="rect" data-original-coords="133,1346,216,1384">
            <area onclick=station_info(this.title) title="丹鳳"  coords="140,1407,219,1443" shape="rect" data-original-coords="140,1407,219,1443">
            <area onclick=station_info(this.title) title="迴龍"  coords="133,1456,218,1505" shape="rect" data-original-coords="133,1456,218,1505">
            -->
            <!-- 黃 -->
            <area onclick=station_info(this.title) title="新北產業園區"  coords="9,1033,124,1103" shape="rect" data-original-coords="9,1033,124,1103">
            <area onclick=station_info(this.title) title="幸福"  coords="76,1115,145,1148" shape="rect" data-original-coords="76,1115,145,1148">
            <area onclick=station_info(this.title) title="新埔民生"  coords="175,1198,239,1272" shape="rect" data-original-coords="175,1198,239,1272">
            <area onclick=station_info(this.title) title="板橋"  coords="302,1313,346,1381" shape="rect" data-original-coords="302,1313,346,1381">
            <area onclick=station_info(this.title) title="板新"  coords="405,1446,357,1371" shape="rect" data-original-coords="405,1446,357,1371">
            <area onclick=station_info(this.title) title="中原"  coords="419,1426,470,1519" shape="rect" data-original-coords="419,1426,470,1519">
            <area onclick=station_info(this.title) title="橋和"  coords="482,1474,535,1590" shape="rect" data-original-coords="482,1474,535,1590">
            <area onclick=station_info(this.title) title="中和"  coords="589,1545,642,1626" shape="rect" data-original-coords="589,1545,642,1626">
            <area onclick=station_info(this.title) title="景平"  coords="768,1545,822,1623" shape="rect" data-original-coords="768,1545,822,1623">
            <area onclick=station_info(this.title) title="秀朗橋"  coords="827,1547,882,1609" shape="rect" data-original-coords="827,1547,882,1609">
            <area onclick=station_info(this.title) title="十四張"  coords="886,1547,943,1613" shape="rect" data-original-coords="886,1547,943,1613">
            <!-- 棕 -->
            <area onclick=station_info(this.title) title="南港軟體園區"  coords="1183,744,1309,802" shape="rect" data-original-coords="1183,744,1309,802">
            <area onclick=station_info(this.title) title="東湖"  coords="1178,701,1292,739" shape="rect" data-original-coords="1178,701,1292,739">
            <area onclick=station_info(this.title) title="葫洲"  coords="1175,640,1292,696" shape="rect" data-original-coords="1175,640,1292,696">
            <area onclick=station_info(this.title) title="大湖公園"  coords="1119,529,1192,615" shape="rect" data-original-coords="1119,529,1192,615">
            <area onclick=station_info(this.title) title="內湖"  coords="1063,538,1110,610" shape="rect" data-original-coords="1063,538,1110,610">
            <area onclick=station_info(this.title) title="文德"  coords="1009,548,1054,615" shape="rect" data-original-coords="1009,548,1054,615">
            <area onclick=station_info(this.title) title="港墘"  coords="951,546,1000,622" shape="rect" data-original-coords="951,546,1000,622">
            <area onclick=station_info(this.title) title="西湖"  coords="882,542,942,620" shape="rect" data-original-coords="882,542,942,620">
            <area onclick=station_info(this.title) title="劍南路"  coords="826,638,942,686" shape="rect" data-original-coords="826,638,942,686">
            <area onclick=station_info(this.title) title="大直"  coords="835,701,922,739" shape="rect" data-original-coords="835,701,922,739">
            <area onclick=station_info(this.title) title="松山機場"  coords="824,764,957,805" shape="rect" data-original-coords="824,764,957,805">
            <area onclick=station_info(this.title) title="中山國中"  coords="823,814,965,865" shape="rect" data-original-coords="823,814,965,865">
            <area onclick=station_info(this.title) title="科技大樓"  coords="823,1224,937,1270" shape="rect" data-original-coords="823,1224,937,1270">
            <area onclick=station_info(this.title) title="六張犁"  coords="943,1244,1003,1323" shape="rect" data-original-coords="943,1244,1003,1323">
            <area onclick=station_info(this.title) title="麟光"  coords="1009,1246,1060,1326" shape="rect" data-original-coords="1009,1246,1060,1326">
            <area onclick=station_info(this.title) title="辛亥"  coords="1068,1252,1108,1318" shape="rect" data-original-coords="1068,1252,1108,1318">
            <area onclick=station_info(this.title) title="萬芳醫院"  coords="1123,1233,1174,1326" shape="rect" data-original-coords="1123,1233,1174,1326">
            <area onclick=station_info(this.title) title="萬芳社區"  coords="1183,1337,1309,1385" shape="rect" data-original-coords="1183,1337,1309,1385">
            <area onclick=station_info(this.title) title="木柵"  coords="1190,1401,1270,1454" shape="rect" data-original-coords="1190,1401,1270,1454">
            <!-- <area onclick=station_info(this.title) alt="動物園" title="動物園"  coords="1183,1465,1296,1503" shape="rect" data-original-coords="1183,1465,1296,1503"> -->
        </map>

        <div class="loacate_collapseTime_container">
            <h1>各小隊位置</h1> 
            <h2 id="next_collapse_time_label"></h2>
        </div>

        <div class="team_locate">
            <p>零小:</p><p id="team0_location"></p>
            <p>一小:</p><p id="team1_location"></p>
            <p>二小:</p><p id="team2_location"></p>
            <p>三小:</p><p id="team3_location"></p>
            <p>四小:</p><p id="team4_location"></p>
        </div>

        <div class="point_is_imprisoned_container">
            <h1>各小隊分數</h1>
            <h2 id="is_imprisoned_label"></h2>
        </div>
        1
        <div class="team_point">
            <div class="scoreboard">
                <div class="team" id="team0" data-score="0">
                    <span class="team-name">零小</span>
                    <div class="progress-bar">
                        <div class="progress" id="teamA-progress"></div>
                    </div>
                    <span class="score">0 分</span>
                </div>
                <div class="team" id="team1" data-score="0">
                    <span class="team-name">一小</span>
                    <div class="progress-bar">
                        <div class="progress" id="teamB-progress"></div>
                    </div>
                    <span class="score">0 分</span>
                </div>
                <div class="team" id="team2" data-score="0">
                    <span class="team-name">二小</span>
                    <div class="progress-bar">
                        <div class="progress" id="teamC-progress"></div>
                    </div>
                    <span class="score">0 分</span>
                </div>
                <div class="team" id="team3" data-score="0">
                    <span class="team-name">三小</span>
                    <div class="progress-bar">
                        <div class="progress" id="teamD-progress"></div>
                    </div>
                    <span class="score">0 分</span>
                </div>
                <div class="team" id="team4" data-score="0">
                    <span class="team-name">四小</span>
                    <div class="progress-bar">
                        <div class="progress" id="teamD-progress"></div>
                    </div>
                    <span class="score">0 分</span>
                </div>
            </div>
        </div>
    </body>

    <script>

        // ready
        document.addEventListener("DOMContentLoaded", () => {
            resizeMap();
            showMap();
            showCollapse_time();
            showPoint();
            showLocate();
            showImprisoned();
            getCurrentLocation();
        });


        // repeat
        setInterval(showMap, 10000);
        setInterval(showCollapse_time,10000);
        setInterval(showPoint, 10000);
        setInterval(showLocate, 10000);
        setInterval(showImprisoned, 10000);
        

        function resizeMap() {
            const img = document.querySelector('.MRT_map img[style*="display: block"]');
            if (!img) return;  // No visible image
            const map = document.querySelector('map[name="image-map"]');
            const areas = map.getElementsByTagName('area');
            const imgWidth = img.naturalWidth;
            const imgHeight = img.naturalHeight;
            const widthRatio = img.width / imgWidth;
            const heightRatio = img.height / imgHeight;

            for (let i = 0; i < areas.length; i++) {
                const originalCoords = areas[i].getAttribute('data-original-coords').split(',').map(Number);
                const newCoords = originalCoords.map((coord, index) => {
                    return index % 2 === 0 ? coord * widthRatio : coord * heightRatio;
                });
                areas[i].setAttribute('coords', newCoords.join(','));
            }
        }
        window.addEventListener('resize', resizeMap);
        window.addEventListener('load', resizeMap);
    

        function checkImageExists(imageUrl) {
            return fetch(imageUrl, { method: 'HEAD' })
            .then(response => response.ok)
            .catch(() => false);
        }
        function station_info(station_name) {
            station_name = station_name.replace("/","_")
            Promise.all([
                fetch(`http://localhost:8080/api/station/${station_name}`).then(response => response.json()),
                fetch(`http://localhost:8080/api/team/{{team}}`).then(response => response.json())
            ])
            .then(([data,team_data]) => {
                let imageUrl = `../static/img/stations/${station_name}.jpg`;
                checkImageExists(imageUrl).then(exists => {
                let imageHtml = exists ? `<img src="${imageUrl}" alt="${station_name} 圖片" style="width:60%; height:auto;">` : '';
                let lebel_image = (data.is_special === false || station_name === team_data.location) ? imageHtml: "";
                let lebel_is_special = (data.is_special) ? "是" : "否";
                let label_team = (data.team) ? data.team : "無人佔領";
                let label_depiction = (data.is_special === false || station_name === team_data.location) ? data.mission: "隱藏";
                let label_exit = (data.is_special === false || station_name === team_data.location) ? data.exit : "隱藏";
                let lebel_difficult = null;
                if (data.difficult == 1){lebel_difficult="簡單";}
                else if (data.difficult == 2){lebel_difficult="普通";}
                else if (data.difficult == 3){lebel_difficult="困難";}
                station_name = station_name.replace("_","/")
                    
                Swal.fire({
                    title: `${station_name} 站點資訊`,
                    html: `
                        <p>特殊站 : ${lebel_is_special}</p>
                        <p>佔領的小隊 : ${label_team}</p>
                        <p>任務敘述 : ${label_depiction}</p>
                        <p>任務出口 : ${label_exit}</p>
                        <p>任務難度: ${lebel_difficult}</p>
                        ${lebel_image}
                    `,
                    confirmButtonText: "關閉",
                    showCancelButton: true,
                    cancelButtonText: "提示",
                    customClass: {cancelButton: 'swal-button-yellow'},
                }).then((result) => {
                if (result.dismiss === Swal.DismissReason.cancel) {
                    Swal.fire({
                        title: '提示',
                        text: `${data.tips}`,
                        confirmButtonText: "關閉",
                        });
                    }
                });
            });
        })
        }


        const chineseNumerals = {'零': 0, '一': 1,'二': 2, '三': 3,'四': 4,};
        function showLocate() {
            fetch('http://localhost:8080/api/teams')
            .then(response => response.json())
            .then(data => {
                data.forEach(team => {
                    // 提取隊名中的數字部分，例如 "零小" -> "0"
                    const chineseNumeral = team.name.charAt(0); // 假設隊名的第一個字符是中文數字
                    const teamNumber = chineseNumerals[chineseNumeral];
            
                    if (teamNumber !== undefined) {
                        const locationElement = document.getElementById(`team${teamNumber}_location`);
                        if (locationElement) {
                            locationElement.textContent = `${team.location}`;
                        }
                    }
                });
            })
            .catch(error => console.error('Error fetching data:', error));
        }

        function showPoint() {
            fetch('http://localhost:8080/api/teams')
            .then(response => response.json())
            .then(data => {
                const teams = document.querySelectorAll(".team");
                const maxScore = 3000; 

                data.forEach(teamData => {
                    const chineseNumeral = teamData.name.charAt(0); // 假設隊名的第一個字符是中文數字
                    const teamNumber = chineseNumerals[chineseNumeral];

                    if (teamNumber !== undefined && teams[teamNumber]) {
                        const teamElement = teams[teamNumber];
                        const score = teamData.point;
                        const progressBar = teamElement.querySelector(".progress");
                        const scoreElement = teamElement.querySelector(".score");

                        teamElement.setAttribute("data-score", score);

                        const widthPercent = (score / maxScore) * 100;
                        progressBar.style.width = widthPercent + "%";

                        scoreElement.textContent = `${score} 分`;
                    }
                });
            })
            .catch(error => console.error('Error fetching data:', error));
        }


        let lastStatus = null;
        let lastWarning = null;
        function showMap(){
            fetch('http://localhost:8080/api/collapse_status')
                .then(response => response.json())
                .then(data => {
                    if (data.status !== lastStatus || data.warning !== lastWarning) {
                        lastStatus = data.status;
                        lastWarning = data.warning;
                        let images = document.querySelectorAll('.MRT_map img');
                        images.forEach(img => img.style.display = 'none');

                        if (data.warning === false) {
                            if (data.status === 0) {
                                document.getElementById('Map0').style.display = 'block';
                            } else if (data.status === 1) {
                                document.getElementById('Map2').style.display = 'block';
                            } else if (data.status === 2) {
                                document.getElementById('Map4').style.display = 'block';
                            }
                        } else {
                            if (data.status === 0) {
                                document.getElementById('Map1').style.display = 'block';
                            } else if (data.status === 1) {
                                document.getElementById('Map3').style.display = 'block';
                            }
                        }
                    }
                })
                .catch(error => console.error('Error fetching data:', error));
        }


        function showCollapse_time(){
            fetch('http://localhost:8080/api/next_collapse_time')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('next_collapse_time_label').textContent = `下次崩塌時間 : ${data}`;
                })
                .catch(error => console.error('Error fetching data:', error));
        }


        function showImprisoned(){
            fetch('http://localhost:8080/api/team/{{team}}')
                .then(response => response.json())
                .then(data => {
                    if(data.is_imprisoned){
                        document.getElementById('is_imprisoned_label').textContent = `監獄剩餘時間 : ${data.imprisoned_time} 分鐘`;
                    }
                })
                .catch(error => console.error('Error fetching data:', error));
        }


        function getCurrentLocation(){
            // 先確認使用者裝置能不能抓地點
            if(navigator.geolocation) {

                // 使用者不提供權限，或是發生其它錯誤
                function error() {
                    alert('無法取得你的位置');
                }

                // 使用者允許抓目前位置，回傳經緯度
                function success(position) {
                    fetch(`http://localhost:8080/api/gps_location/{{team}}/${position.coords.latitude}/${position.coords.longitude}`)
                }

                // 跟使用者拿所在位置的權限
                navigator.geolocation.getCurrentPosition(success, error);

            } else {
                alert('Sorry, 你的裝置不支援地理位置功能。')
            }
        }    
    </script>
</html>